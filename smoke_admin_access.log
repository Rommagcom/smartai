{"ts": "2026-02-26T09:52:15.815213+00:00", "level": "WARNING", "logger": "app.main", "message": "Milvus init skipped", "error": "<MilvusException: (code=2, message=Fail connecting to server on localhost:19530, illegal connection params or server unavailable)>"}
{"ts": "2026-02-26T09:52:15.815667+00:00", "level": "WARNING", "logger": "observability.alerts", "message": "Milvus init skipped", "component": "startup", "severity": "warning", "details": {"error": "<MilvusException: (code=2, message=Fail connecting to server on localhost:19530, illegal connection params or server unavailable)>"}}
{"ts": "2026-02-26T09:52:15.819880+00:00", "level": "INFO", "logger": "apscheduler.scheduler", "message": "Scheduler started"}
{"ts": "2026-02-26T09:52:15.823455+00:00", "level": "INFO", "logger": "apscheduler.scheduler", "message": "Added job \"SchedulerService.periodic_proactive_ping\" to job store \"default\""}
{"ts": "2026-02-26T09:52:15.823933+00:00", "level": "INFO", "logger": "app.services.scheduler_service", "message": "scheduler started", "component": "scheduler", "event": "start"}
{"ts": "2026-02-26T09:52:19.900728+00:00", "level": "ERROR", "logger": "observability.alerts", "message": "scheduler bootstrap failed", "component": "scheduler", "severity": "critical", "details": {"error": "[WinError 1225] Удаленный компьютер отклонил это сетевое подключение"}}
{"ts": "2026-02-26T09:52:19.900963+00:00", "level": "ERROR", "logger": "app.main", "message": "scheduler bootstrap failed", "exc": "Traceback (most recent call last):\n  File \"C:\\Repositories\\ИИ Ассистент проект\\backend\\app\\main.py\", line 34, in lifespan\n    await scheduler_service.bootstrap_from_db()\n  File \"C:\\Repositories\\ИИ Ассистент проект\\backend\\app\\services\\scheduler_service.py\", line 56, in bootstrap_from_db\n    result = await db.execute(\n             ^^^^^^^^^^^^^^^^^\n        select(CronJob).where(CronJob.is_active.is_(True)).order_by(CronJob.created_at.desc())\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\ext\\asyncio\\session.py\", line 463, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 201, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2365, in execute\n    return self._execute_internal(\n           ~~~~~~~~~~~~~~~~~~~~~~^\n        statement,\n        ^^^^^^^^^^\n    ...<4 lines>...\n        _add_event=_add_event,\n        ^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2241, in _execute_internal\n    conn = self._connection_for_bind(bind)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2110, in _connection_for_bind\n    return trans._connection_for_bind(engine, execution_options)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in _connection_for_bind\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 137, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1189, in _connection_for_bind\n    conn = bind.connect()\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3277, in connect\n    return self._connection_cls(self)\n           ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 143, in __init__\n    self._dbapi_connection = engine.raw_connection()\n                             ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 3301, in raw_connection\n    return self.pool.connect()\n           ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 447, in connect\n    return _ConnectionFairy._checkout(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 1264, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 711, in checkout\n    rec = pool._do_get()\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 177, in _do_get\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\impl.py\", line 175, in _do_get\n    return self._create_connection()\n           ~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 388, in _create_connection\n    return _ConnectionRecord(self)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 673, in __init__\n    self.__connect()\n    ~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 899, in __connect\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 224, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 895, in __connect\n    self.dbapi_connection = connection = pool._invoke_creator(self)\n                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\create.py\", line 661, in connect\n    return dialect.connect(*cargs, **cparams)\n           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 629, in connect\n    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 964, in connect\n    await_only(creator_fn(*arg, **kw)),\n    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 2421, in connect\n    return await connect_utils._connect(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<20 lines>...\n    )\n    ^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1075, in _connect\n    raise last_error or exceptions.TargetServerAttributeNotMatched(\n    ...<2 lines>...\n    )\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 1049, in _connect\n    conn = await _connect_addr(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 886, in _connect_addr\n    return await __connect_addr(params, True, *args)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 931, in __connect_addr\n    tr, pr = await connector\n             ^^^^^^^^^^^^^^^\n  File \"C:\\Repositories\\ИИ Ассистент проект\\.venv\\Lib\\site-packages\\asyncpg\\connect_utils.py\", line 802, in _create_ssl_connection\n    tr, pr = await loop.create_connection(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n        host, port)\n        ^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1165, in create_connection\n    raise exceptions[0]\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1135, in create_connection\n    sock = await self._connect_sock(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n        exceptions, addrinfo, laddr_infos)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\base_events.py\", line 1038, in _connect_sock\n    await self.sock_connect(sock, address)\n  File \"C:\\Python313\\Lib\\asyncio\\proactor_events.py\", line 726, in sock_connect\n    return await self._proactor.connect(sock, address)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Python313\\Lib\\asyncio\\windows_events.py\", line 804, in _poll\n    value = callback(transferred, key, ov)\n  File \"C:\\Python313\\Lib\\asyncio\\windows_events.py\", line 600, in finish_connect\n    ov.getresult()\n    ~~~~~~~~~~~~^^\nConnectionRefusedError: [WinError 1225] Удаленный компьютер отклонил это сетевое подключение"}
{"ts": "2026-02-26T09:52:19.938030+00:00", "level": "WARNING", "logger": "observability.alerts", "message": "Scheduler bootstrap failed", "component": "startup", "severity": "warning", "details": {"error": "[WinError 1225] Удаленный компьютер отклонил это сетевое подключение"}}
{"ts": "2026-02-26T09:52:19.938186+00:00", "level": "INFO", "logger": "app.main", "message": "application started", "component": "app", "event": "startup"}
{"ts": "2026-02-26T09:52:20.045834+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://testserver/api/v1/auth/register \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.072931+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: POST http://testserver/api/v1/auth/register \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.078154+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/users/me \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.080792+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/users/me \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.083498+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/users/admin/users \"HTTP/1.1 403 Forbidden\""}
{"ts": "2026-02-26T09:52:20.086961+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/observability/metrics \"HTTP/1.1 403 Forbidden\""}
{"ts": "2026-02-26T09:52:20.092394+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/users/admin/users \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.098186+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PATCH http://testserver/api/v1/users/admin/users/dcece6d6-740c-4fd4-97c7-57028ee4200b/admin-access \"HTTP/1.1 400 Bad Request\""}
{"ts": "2026-02-26T09:52:20.124522+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PATCH http://testserver/api/v1/users/admin/users/7acdb723-bd43-4885-9ebf-01995ada96fb/admin-access \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.134721+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PATCH http://testserver/api/v1/users/admin/users/dcece6d6-740c-4fd4-97c7-57028ee4200b/admin-access \"HTTP/1.1 200 OK\""}
{"ts": "2026-02-26T09:52:20.139286+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: PATCH http://testserver/api/v1/users/admin/users/7acdb723-bd43-4885-9ebf-01995ada96fb/admin-access \"HTTP/1.1 400 Bad Request\""}
{"ts": "2026-02-26T09:52:20.142208+00:00", "level": "INFO", "logger": "httpx", "message": "HTTP Request: GET http://testserver/api/v1/observability/metrics \"HTTP/1.1 403 Forbidden\""}
{"ts": "2026-02-26T09:52:20.142717+00:00", "level": "INFO", "logger": "app.services.scheduler_service", "message": "scheduler stopped", "component": "scheduler", "event": "shutdown"}
{"ts": "2026-02-26T09:52:20.142918+00:00", "level": "INFO", "logger": "apscheduler.scheduler", "message": "Scheduler has been shut down"}
{"ts": "2026-02-26T09:52:20.143239+00:00", "level": "WARNING", "logger": "app.main", "message": "websocket manager stop failed", "error": "Error 22 connecting to localhost:6379. Удаленный компьютер отклонил это сетевое подключение."}
{"ts": "2026-02-26T09:52:20.143287+00:00", "level": "WARNING", "logger": "observability.alerts", "message": "Websocket manager stop failed", "component": "startup", "severity": "warning", "details": {"error": "Error 22 connecting to localhost:6379. Удаленный компьютер отклонил это сетевое подключение."}}
{"ts": "2026-02-26T09:52:20.143376+00:00", "level": "INFO", "logger": "app.main", "message": "application stopped", "component": "app", "event": "shutdown"}
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Repositories\ИИ Ассистент проект\backend\scripts\smoke_admin_access.py", line 129, in <module>
    asyncio.run(run())
    ~~~~~~~~~~~^^^^^^^
  File "C:\Python313\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "C:\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Python313\Lib\asyncio\base_events.py", line 719, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Repositories\ИИ Ассистент проект\backend\scripts\smoke_admin_access.py", line 109, in run
    ensure(admin_metrics.status_code == 200, f"admin metrics failed: {admin_metrics.text}")
    ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Repositories\ИИ Ассистент проект\backend\scripts\smoke_admin_access.py", line 19, in ensure
    raise RuntimeError(message)
RuntimeError: admin metrics failed: {"detail":"Admin access required"}
